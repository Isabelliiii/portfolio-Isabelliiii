{
  "hash": "ae8c90408b4221007ad877750324ff8e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Predictive Policing - Technical Implementation\"\nsubtitle: \"MUSA 5080 - Fall 2025\"\nauthor: \"Isabelle Li\"\ndate: today\nformat:\n  html:\n    code-fold: show\n    code-tools: true\n    toc: true\n    toc-depth: 3\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\neditor: visual\nexecute:\n  warning: false\n  message: false\n---\n\n\n::: {.cell}\n\n:::\n\n\n# Part 1: Load and Explore Data\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\nThere are **7,482 burglary incidents** in the dataset.\\\nThese records come from the **Chicago Crimes 2017** data, representing all **reported burglary (forcible entry)** cases during that calendar year.\n\nDatasets are projected into Illinois State Plane East (EPSG:102271) for accurate distance and area calculations.\n\n## 1.2: Visualize Point Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simple point map\np1 <- ggplot() + \n  geom_sf(data = chicagoBoundary, fill = \"gray95\", color = \"gray60\") +\n  geom_sf(data = burglaries, color = \"#d62828\", size = 0.1, alpha = 0.4) +\n  labs(\n    title = \"Burglary Locations\",\n    subtitle = paste0(\"Chicago 2017, n = \", nrow(burglaries))\n  )\n\n# Density surface using modern syntax\np2 <- ggplot() + \n  geom_sf(data = chicagoBoundary, fill = \"gray95\", color = \"gray60\") +\n  geom_density_2d_filled(\n    data = data.frame(st_coordinates(burglaries)),\n    aes(X, Y),\n    alpha = 0.7,\n    bins = 8\n  ) +\n  scale_fill_viridis_d(\n    option = \"plasma\",\n    direction = -1,\n    guide = \"none\"  # Modern ggplot2 syntax (not guide = FALSE)\n  ) +\n  labs(\n    title = \"Density Surface\",\n    subtitle = \"Kernel density estimation\"\n  )\n\n# Combine plots using patchwork (modern approach)\np1 + p2 + \n  plot_annotation(\n    title = \"Spatial Distribution of Burglaries in Chicago\",\n    tag_levels = 'A'\n  )\n```\n\n::: {.cell-output-display}\n![](predictive_policing_exercise_files/figure-html/visualize-points-1.png){width=960}\n:::\n:::\n\n\nThe burglary incidents are **not evenly distributed** across Chicago. Instead, they exhibit a clear clustered pattern, with several well-defined hot spots.\n\nThe **highest concentrations** appear in:\n\n-   the **West Side** (especially near Humboldt Park and Garfield Park),\n\n-   parts of the **South Side**, and\n\n-   portions of the **Near North / Near West** areas.\n\nIn contrast, the Northwest and Southwest outer neighborhoods show very few incidents, indicating substantially lower burglary activity.\n\n# Part 2: Create Fishnet Grid\n\n## 2.1: Understanding the Fishnet\n\nA **fishnet grid** converts irregular point data into a regular grid of cells where we can:\n\n-   Aggregate counts\n-   Calculate spatial features\n-   Apply regression models\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create 500m x 500m grid\nfishnet <- st_make_grid(\n  chicagoBoundary,\n  cellsize = 500,  # 500 meters per cell\n  square = TRUE\n) %>%\n  st_sf() %>%\n  mutate(uniqueID = row_number())\n\n# Keep only cells that intersect Chicago\nfishnet <- fishnet[chicagoBoundary, ]\n```\n:::\n\n\nWe use a regular fishnet grid because it provides **equal-sized spatial units**, which makes burglary counts directly comparable across the entire study area. Neighborhoods or census tracts vary widely in size and shape, and those differences can distort the spatial patterns we observe or bias the regression results. A uniform grid avoids those issues and creates a consistent framework for aggregating incidents, calculating spatial features, and fitting predictive models.\n\n## 2.2: Aggregate Burglaries to Grid\n\n\n::: {.cell}\n\n```{.r .cell-code}\nburglaries_fishnet <- st_join(burglaries, fishnet, join = st_within) %>%\n  st_drop_geometry() %>%\n  group_by(uniqueID) %>%\n  summarize(countBurglaries = n())\n\n# Join back to fishnet (cells with 0 burglaries will be NA)\nfishnet <- fishnet %>%\n  left_join(burglaries_fishnet, by = \"uniqueID\") %>%\n  mutate(countBurglaries = replace_na(countBurglaries, 0))\n\nfishnet %>%\n  st_drop_geometry() %>%\n  summarize(\n    Min = min(countBurglaries),\n    Q1 = quantile(countBurglaries, 0.25),\n    Median = median(countBurglaries),\n    Mean = mean(countBurglaries),\n    Q3 = quantile(countBurglaries, 0.75),\n    Max = max(countBurglaries),\n    Percent_zero = mean(countBurglaries == 0) * 100\n  ) %>%\n  mutate(across(everything(), ~round(., 2))) %>%\n  kable(\n    caption = \"Summary of Burglary Counts per 500m Grid Cell\"\n  ) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Summary of Burglary Counts per 500m Grid Cell</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> Min </th>\n   <th style=\"text-align:right;\"> Q1 </th>\n   <th style=\"text-align:right;\"> Median </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Q3 </th>\n   <th style=\"text-align:right;\"> Max </th>\n   <th style=\"text-align:right;\"> Percent_zero </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 3.04 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 40 </td>\n   <td style=\"text-align:right;\"> 31.77 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize aggregated counts\nggplot() +\n  geom_sf(data = fishnet, aes(fill = countBurglaries), color = NA) +\n  geom_sf(data = chicagoBoundary, fill = NA, color = \"white\", linewidth = 1) +\n  scale_fill_viridis_c(\n    name = \"Burglaries\",\n    option = \"plasma\",\n    trans = \"sqrt\",  # Square root for better visualization of skewed data\n    breaks = c(0, 1, 5, 10, 20, 40)\n  ) +\n  labs(\n    title = \"Burglary Counts by Grid Cell\",\n    subtitle = \"500m x 500m cells, Chicago 2017\"\n  ) +\n  theme_crime()\n```\n\n::: {.cell-output-display}\n![](predictive_policing_exercise_files/figure-html/visualize-fishnet-1.png){width=768}\n:::\n:::\n\n\nThe distribution of burglary counts across grid cells is **highly skewed**. Most cells have **zero or very few incidents**, while a smaller number of cells contain moderate or high counts. This creates a classic “long-tail” distribution: many zeros, many low values, and a few high-value hot spots.\n\nThere are so many zero-burglary cells because a large portion of Chicago consists of areas where burglaries are rare—low-density residential zones, industrial corridors, parks, and other land uses that generate fewer targets or fewer opportunities for burglary. Burglary risk is not spatially uniform, so it is expected that many cells simply have no incidents during the study year.\n\n# Part 3: Create a Kernel Density Baseline\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = fishnet, aes(fill = kde_value), color = NA) +\n  geom_sf(data = chicagoBoundary, fill = NA, color = \"white\", linewidth = 1) +\n  scale_fill_viridis_c(\n    name = \"KDE Value\",\n    option = \"plasma\"\n  ) +\n  labs(\n    title = \"Kernel Density Estimation Baseline\",\n    subtitle = \"Simple spatial smoothing of burglary locations\"\n  ) +\n  theme_crime()\n```\n\n::: {.cell-output-display}\n![](predictive_policing_exercise_files/figure-html/visualize-kde-1.png){width=768}\n:::\n:::\n\n\nThe KDE map produces a much smoother representation of burglary intensity compared to the raw count map. While the grid-based count map shows sharp cell-to-cell variation that high counts next to zero counts, the KDE surface spreads each point’s influence over space, revealing the **underlying structure** of burglary hot spots.\n\n# Part 4: Create Spatial Predictor Variables\n\n\n::: {.cell}\n\n:::\n\n\n## 4.1: Count of Abandoned Cars per Cell\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRemoval_fishnet <- st_join(fishnet, Graffiti_removal, join = st_contains) %>%\n  st_drop_geometry() %>%\n  count(uniqueID, name = \"Graffiti_removal\")\n\nfishnet$Graffiti_removal <- 0L\n\nidx <- match(Removal_fishnet$uniqueID, fishnet$uniqueID)\nfishnet$Graffiti_removal[idx] <- Removal_fishnet$Graffiti_removal\n\nfishnet %>%\n  st_drop_geometry() %>%\n  summarize(\n    Min = min(Graffiti_removal),\n    Q1 = quantile(Graffiti_removal, 0.25),\n    Median = median(Graffiti_removal),\n    Mean = mean(Graffiti_removal),\n    Q3 = quantile(Graffiti_removal, 0.75),\n    Max = max(Graffiti_removal)\n  ) %>%\n  mutate(across(everything(), ~round(., 2))) %>%\n  kable(\n    caption = \"Summary of Graffiti Removal 311 Calls per 500m Grid Cell\"\n  ) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Summary of Graffiti Removal 311 Calls per 500m Grid Cell</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> Min </th>\n   <th style=\"text-align:right;\"> Q1 </th>\n   <th style=\"text-align:right;\"> Median </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Q3 </th>\n   <th style=\"text-align:right;\"> Max </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 80 </td>\n   <td style=\"text-align:right;\"> 427.82 </td>\n   <td style=\"text-align:right;\"> 487.75 </td>\n   <td style=\"text-align:right;\"> 7590 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot() +\n  geom_sf(data = fishnet, aes(fill = Graffiti_removal), color = NA) +\n  scale_fill_viridis_c(name = \"Count\", option = \"magma\") +\n  labs(title = \"Graffiti Removal 311 Calls\") +\n  theme_crime()\n\np2 <- ggplot() +\n  geom_sf(data = fishnet, aes(fill = countBurglaries), color = NA) +\n  scale_fill_viridis_c(name = \"Count\", option = \"plasma\") +\n  labs(title = \"Burglaries\") +\n  theme_crime()\n\np1 + p2 +\n  plot_annotation(title = \"Are Graffiti Removal and burglaries correlated?\")\n```\n\n::: {.cell-output-display}\n![](predictive_policing_exercise_files/figure-html/visualize-abandoned-cars-1.png){width=960}\n:::\n:::\n\n\nVisually, there does not appear to be a strong one-to-one spatial relationship between Graffiti Removal 311 calls and burglaries. Graffiti reports are highly concentrated in a few dense pockets especially in the Northwest, West, and parts of the Southwest, reflecting areas where property damage or visible disorder is more common. In contrast, burglaries show a broader and more diffuse spatial pattern with hotspots distributed across the West Side, South Side, and the North-Central corridor.\n\nAlthough there is **some overlap** in general high-activity regions (such as parts of the West Side), the intensity patterns differ in both magnitude and spatial footprint. This suggests that graffiti is related to neighborhood disorder but **is not a direct proxy for burglary risk**. Graffiti reflects public-facing vandalism, while burglary involves private property intrusion, which is driven by different opportunity structures, land uses, and routine activities.\n\n## 4.2: Nearest Neighbor Features\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate mean distance to 3 nearest Graffiti Removal\nGraffiti_clean <- Graffiti_removal %>%\n  filter(!st_is_empty(geometry))\n\n# Get coordinates\nfishnet_coords <- st_coordinates(st_centroid(fishnet))\nremoval_coords <- st_coordinates(Graffiti_clean)\n\n# Calculate k nearest neighbors and distances\nnn_result <- get.knnx(removal_coords, fishnet_coords, k = 3)\n\n# Add to fishnet\nfishnet <- fishnet %>%\n  mutate(\n    Graffiti_clean.nn = rowMeans(nn_result$nn.dist)\n  )\n\nfishnet %>%\n  st_drop_geometry() %>%\n  summarize(\n    Min = min(Graffiti_clean.nn),\n    Q1 = quantile(Graffiti_clean.nn, 0.25),\n    Median = median(Graffiti_clean.nn),\n    Mean = mean(Graffiti_clean.nn),\n    Q3 = quantile(Graffiti_clean.nn, 0.75),\n    Max = max(Graffiti_clean.nn)\n  ) %>%\n  mutate(across(everything(), ~round(., 2))) %>%\n  kable(\n    caption = \"Summary of Mean Distance to 3 Nearest Graffiti Removal Calls (meters)\"\n  ) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Summary of Mean Distance to 3 Nearest Graffiti Removal Calls (meters)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> Min </th>\n   <th style=\"text-align:right;\"> Q1 </th>\n   <th style=\"text-align:right;\"> Median </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Q3 </th>\n   <th style=\"text-align:right;\"> Max </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.55 </td>\n   <td style=\"text-align:right;\"> 28.61 </td>\n   <td style=\"text-align:right;\"> 60.28 </td>\n   <td style=\"text-align:right;\"> 135.14 </td>\n   <td style=\"text-align:right;\"> 137.95 </td>\n   <td style=\"text-align:right;\"> 1476.26 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThe distance-to-graffiti feature shows substantial variation, with a median of \\~60 m but a long tail up to 1.4 km. This indicates that some neighborhoods are very close to multiple graffiti complaints, while others are far removed. This spatial heterogeneity helps capture environmental disorder that may relate to burglary risk.\n\n## 4.3: Distance to Hot Spots\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize hot spots\nggplot() +\n  geom_sf(\n    data = fishnet, \n    aes(fill = moran_class), \n    color = NA\n  ) +\n  scale_fill_manual(\n    values = c(\n      \"High-High\" = \"#d7191c\",\n      \"High-Low\" = \"#fdae61\",\n      \"Low-High\" = \"#abd9e9\",\n      \"Low-Low\" = \"#2c7bb6\",\n      \"Not Significant\" = \"gray90\"\n    ),\n    name = \"Cluster Type\"\n  ) +\n  labs(\n    title = \"Local Moran's I: Graffiti Removal Clusters\",\n    subtitle = \"High-High = Hot spots of disorder\"\n  ) +\n  theme_crime()\n```\n\n::: {.cell-output-display}\n![](predictive_policing_exercise_files/figure-html/visualize-morans-1.png){width=768}\n:::\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\nDistance to a cluster of Graffiti Removal calls is more informative than distance to a single graffiti incident because it captures the broader neighborhood context of disorder. A single report might be noisy or idiosyncratic, but a High–High cluster from Local Moran’s I represents an area where both the cell and its neighbors have consistently high graffiti counts. Being close to such a cluster suggests that a grid cell lies within or near a larger zone of visible deterioration or neglect.\n\n------------------------------------------------------------------------\n\n\n::: {.cell}\n\n:::\n\n\n# Part 5: Model Fitting\n\n## 5.1: Poisson Regression\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit Poisson regression\nlibrary(broom)\n\nmodel_poisson <- glm(\n  countBurglaries ~ Graffiti_removal + Graffiti_clean.nn + \n    dist_to_hotspot,\n  data = fishnet_model,\n  family = \"poisson\"\n)\n\npoisson_tbl <- tidy(model_poisson) %>% \n  mutate(\n    estimate = round(estimate, 4),\n    std.error = round(std.error, 4),\n    statistic = round(statistic, 2),\n    p.value = round(p.value, 4)\n  )\n\nkable(\n  poisson_tbl,\n  caption = \"Poisson Regression Results\"\n) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Poisson Regression Results</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 1.5900 </td>\n   <td style=\"text-align:right;\"> 0.0260 </td>\n   <td style=\"text-align:right;\"> 61.15 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Graffiti_removal </td>\n   <td style=\"text-align:right;\"> 0.0001 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 4.74 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Graffiti_clean.nn </td>\n   <td style=\"text-align:right;\"> -0.0063 </td>\n   <td style=\"text-align:right;\"> 0.0003 </td>\n   <td style=\"text-align:right;\"> -22.46 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dist_to_hotspot </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 3.76 </td>\n   <td style=\"text-align:right;\"> 0.0002 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n**All three predictors are statistically significant (p \\< 0.001).**\n\n1.   **Graffiti_removal** has a *positive* association with burglary counts.\n\n    More graffiti complaints → slightly more burglaries.\n\n2.  **Graffiti_clean.nn** has a *strong negative* association.\n\n    Cells closer to graffiti activity → much higher burglary risk.\n\n    This is the strongest predictor in the model.\n\n3.  **dist_to_hotspot** has a very weak but statistically significant *positive* association.\n\n    Being farther from graffiti hotspots slightly increases predicted burglaries.\n\n    Effect size is tiny and may not be meaningful.\n\n\n::: {.cell}\n\n:::\n\n\n## 6.2: Negative Binomial Regression\n\nIf overdispersed, use **Negative Binomial regression** (more flexible).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit Negative Binomial model\nmodel_nb <- glm.nb(\n  countBurglaries ~ Graffiti_removal + Graffiti_clean.nn + \n    dist_to_hotspot,\n  data = fishnet_model\n)\n\nnb_tbl <- tidy(model_nb) %>%\n  mutate(\n    estimate = round(estimate, 4),\n    std.error = round(std.error, 4),\n    statistic = round(statistic, 2),\n    p.value = round(p.value, 4)\n  )\n\nkable(\n  nb_tbl,\n  caption = \"Negative Binomial Regression Results\"\n) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Negative Binomial Regression Results</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 1.6604 </td>\n   <td style=\"text-align:right;\"> 0.0497 </td>\n   <td style=\"text-align:right;\"> 33.38 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Graffiti_removal </td>\n   <td style=\"text-align:right;\"> 0.0001 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 1.55 </td>\n   <td style=\"text-align:right;\"> 0.1211 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Graffiti_clean.nn </td>\n   <td style=\"text-align:right;\"> -0.0079 </td>\n   <td style=\"text-align:right;\"> 0.0005 </td>\n   <td style=\"text-align:right;\"> -17.15 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dist_to_hotspot </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 3.34 </td>\n   <td style=\"text-align:right;\"> 0.0008 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nIts AIC (7654) is substantially lower than the Poisson model's AIC (9456), indicating that the NB model provides a better balance between model complexity and goodness of fit.\n\nThe improvement confirms that our burglary count data are overdispersed (variance \\> mean), which violates a key Poisson assumption. As a result, the Poisson model inflated the significance of several predictors, while the NB model provides more reliable coefficient estimates.\n\n# Part 7: Spatial Cross-Validation\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Show results\ncv_results %>%\n  arrange(desc(mae)) %>%\n  kable(\n    digits = 2,\n    caption = \"LOGO CV Results by District\"\n  ) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>LOGO CV Results by District</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> fold </th>\n   <th style=\"text-align:left;\"> test_district </th>\n   <th style=\"text-align:right;\"> n_test </th>\n   <th style=\"text-align:right;\"> mae </th>\n   <th style=\"text-align:right;\"> rmse </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 43 </td>\n   <td style=\"text-align:right;\"> 6.31 </td>\n   <td style=\"text-align:right;\"> 8.42 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:left;\"> 6 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 3.87 </td>\n   <td style=\"text-align:right;\"> 5.35 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:left;\"> 12 </td>\n   <td style=\"text-align:right;\"> 73 </td>\n   <td style=\"text-align:right;\"> 3.44 </td>\n   <td style=\"text-align:right;\"> 4.63 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 235 </td>\n   <td style=\"text-align:right;\"> 3.38 </td>\n   <td style=\"text-align:right;\"> 5.45 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:left;\"> 7 </td>\n   <td style=\"text-align:right;\"> 52 </td>\n   <td style=\"text-align:right;\"> 3.38 </td>\n   <td style=\"text-align:right;\"> 4.23 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:left;\"> 11 </td>\n   <td style=\"text-align:right;\"> 43 </td>\n   <td style=\"text-align:right;\"> 3.12 </td>\n   <td style=\"text-align:right;\"> 4.02 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 15 </td>\n   <td style=\"text-align:left;\"> 18 </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 2.73 </td>\n   <td style=\"text-align:right;\"> 3.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 8 </td>\n   <td style=\"text-align:right;\"> 197 </td>\n   <td style=\"text-align:right;\"> 2.72 </td>\n   <td style=\"text-align:right;\"> 3.72 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:left;\"> 10 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 2.62 </td>\n   <td style=\"text-align:right;\"> 3.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:left;\"> 20 </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 2.58 </td>\n   <td style=\"text-align:right;\"> 2.98 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:left;\"> 14 </td>\n   <td style=\"text-align:right;\"> 46 </td>\n   <td style=\"text-align:right;\"> 2.57 </td>\n   <td style=\"text-align:right;\"> 3.86 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 56 </td>\n   <td style=\"text-align:right;\"> 2.55 </td>\n   <td style=\"text-align:right;\"> 3.41 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:left;\"> 25 </td>\n   <td style=\"text-align:right;\"> 85 </td>\n   <td style=\"text-align:right;\"> 2.54 </td>\n   <td style=\"text-align:right;\"> 3.46 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:left;\"> 9 </td>\n   <td style=\"text-align:right;\"> 107 </td>\n   <td style=\"text-align:right;\"> 2.46 </td>\n   <td style=\"text-align:right;\"> 2.86 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 11 </td>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 28 </td>\n   <td style=\"text-align:right;\"> 2.44 </td>\n   <td style=\"text-align:right;\"> 2.93 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:left;\"> 16 </td>\n   <td style=\"text-align:right;\"> 129 </td>\n   <td style=\"text-align:right;\"> 2.36 </td>\n   <td style=\"text-align:right;\"> 2.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 22 </td>\n   <td style=\"text-align:left;\"> 24 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 2.35 </td>\n   <td style=\"text-align:right;\"> 2.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:left;\"> 15 </td>\n   <td style=\"text-align:right;\"> 32 </td>\n   <td style=\"text-align:right;\"> 2.32 </td>\n   <td style=\"text-align:right;\"> 2.96 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:left;\"> 22 </td>\n   <td style=\"text-align:right;\"> 112 </td>\n   <td style=\"text-align:right;\"> 2.17 </td>\n   <td style=\"text-align:right;\"> 2.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:left;\"> 17 </td>\n   <td style=\"text-align:right;\"> 82 </td>\n   <td style=\"text-align:right;\"> 2.14 </td>\n   <td style=\"text-align:right;\"> 2.48 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 98 </td>\n   <td style=\"text-align:right;\"> 1.92 </td>\n   <td style=\"text-align:right;\"> 2.87 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:left;\"> 19 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 1.91 </td>\n   <td style=\"text-align:right;\"> 2.34 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nSpatial CV is more appropriate than random CV because crime data is highly spatially autocorrelated. Random CV would mix neighboring cells into both training and testing sets, causing spatial leakage and artificially inflating model performance. LOGO CV avoids this by holding out entire police districts, which tests the model’s ability to generalize to new spatial areas.\n\nFrom the results, District 3 was the hardest to predict (MAE = 6.31), followed by District 6, suggesting that these areas have unique burglary patterns not well explained by graffiti-based predictors. In contrast, District 19 was one of the easiest districts to predict (MAE ≈ 1.9), indicating burglary patterns there are more stable and similar to the training data.\n\n# Part 8: Model Predictions and Comparison\n\n\n::: {.cell}\n\n:::\n\n\n## 8.1: Compare Model vs. KDE Baseline\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create three maps\np1 <- ggplot() +\n  geom_sf(data = fishnet, aes(fill = countBurglaries), color = NA) +\n  scale_fill_viridis_c(name = \"Count\", option = \"plasma\", limits = c(0, 15)) +\n  labs(title = \"Actual Burglaries\") +\n  theme_crime()\n\np2 <- ggplot() +\n  geom_sf(data = fishnet, aes(fill = prediction_nb), color = NA) +\n  scale_fill_viridis_c(name = \"Predicted\", option = \"plasma\", limits = c(0, 15)) +\n  labs(title = \"Model Predictions (Neg. Binomial)\") +\n  theme_crime()\n\np3 <- ggplot() +\n  geom_sf(data = fishnet, aes(fill = prediction_kde), color = NA) +\n  scale_fill_viridis_c(name = \"Predicted\", option = \"plasma\", limits = c(0, 15)) +\n  labs(title = \"KDE Baseline Predictions\") +\n  theme_crime()\n\np1 + p2 + p3 +\n  plot_annotation(\n    title = \"Actual vs. Predicted Burglaries\",\n    subtitle = \"Does our complex model outperform simple KDE?\"\n  )\n```\n\n::: {.cell-output-display}\n![](predictive_policing_exercise_files/figure-html/compare-models-1.png){width=1152}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate performance metrics\ncomparison <- fishnet %>%\n  st_drop_geometry() %>%\n  filter(!is.na(prediction_nb), !is.na(prediction_kde)) %>%\n  summarize(\n    model_mae = mean(abs(countBurglaries - prediction_nb)),\n    model_rmse = sqrt(mean((countBurglaries - prediction_nb)^2)),\n    kde_mae = mean(abs(countBurglaries - prediction_kde)),\n    kde_rmse = sqrt(mean((countBurglaries - prediction_kde)^2))\n  )\n\ncomparison %>%\n  pivot_longer(everything(), names_to = \"metric\", values_to = \"value\") %>%\n  separate(metric, into = c(\"approach\", \"metric\"), sep = \"_\") %>%\n  pivot_wider(names_from = metric, values_from = value) %>%\n  kable(\n    digits = 2,\n    caption = \"Model Performance Comparison\"\n  ) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Model Performance Comparison</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> approach </th>\n   <th style=\"text-align:right;\"> mae </th>\n   <th style=\"text-align:right;\"> rmse </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> model </td>\n   <td style=\"text-align:right;\"> 2.56 </td>\n   <td style=\"text-align:right;\"> 3.66 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> kde </td>\n   <td style=\"text-align:right;\"> 2.06 </td>\n   <td style=\"text-align:right;\"> 2.95 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### **The KDE baseline performs better than the complex model**\n\nThe KDE has **lower MAE and RMSE**, which means:\n\n-   Smaller average prediction error\n\n-   More stable predictions\n\n-   Better overall fit to the spatial pattern of burglaries\n\nThis is a common result in spatial prediction tasks: KDE is extremely strong because crime tends to cluster, and KDE captures clustering very well without requiring any assumptions or regression structure.\n\n## 8.2: Where Does the Model Work Well?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate errors\nfishnet <- fishnet %>%\n  mutate(\n    error_nb = countBurglaries - prediction_nb,\n    error_kde = countBurglaries - prediction_kde,\n    abs_error_nb = abs(error_nb),\n    abs_error_kde = abs(error_kde)\n  )\n\n# Map errors\np1 <- ggplot() +\n  geom_sf(data = fishnet, aes(fill = error_nb), color = NA) +\n  scale_fill_gradient2(\n    name = \"Error\",\n    low = \"#2166ac\", mid = \"white\", high = \"#b2182b\",\n    midpoint = 0,\n    limits = c(-10, 10)\n  ) +\n  labs(title = \"Model Errors (Actual - Predicted)\") +\n  theme_crime()\n\np2 <- ggplot() +\n  geom_sf(data = fishnet, aes(fill = abs_error_nb), color = NA) +\n  scale_fill_viridis_c(name = \"Abs. Error\", option = \"magma\") +\n  labs(title = \"Absolute Model Errors\") +\n  theme_crime()\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](predictive_policing_exercise_files/figure-html/prediction-errors-1.png){width=960}\n:::\n:::\n\n\nThe error maps show that the Negative Binomial model systematically underpredicts burglaries in major hotspot areas especially in the South and West Sides, while slightly overpredicting in low-crime neighborhoods. This pattern suggests that the model cannot fully capture sharp, localized spikes in burglary activity, likely because graffiti-related predictors only partially reflect the underlying opportunity structures of crime. As a result, absolute errors are largest in high-crime districts and much smaller in low-crime ones, indicating that the model performs unevenly across space and is least accurate exactly where prediction is most important.\n\n# Part 9: Summary Statistics and Tables\n\n## 9.1: Model Summary Table\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create nice summary table\nmodel_summary <- broom::tidy(final_model, exponentiate = TRUE) %>%\n  mutate(\n    across(where(is.numeric), ~round(., 3))\n  )\n\nmodel_summary %>%\n  kable(\n    caption = \"Final Negative Binomial Model Coefficients (Exponentiated)\",\n    col.names = c(\"Variable\", \"Rate Ratio\", \"Std. Error\", \"Z\", \"P-Value\")\n  ) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\")) %>%\n  footnote(\n    general = \"Rate ratios > 1 indicate positive association with burglary counts.\"\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;border-bottom: 0;\">\n<caption>Final Negative Binomial Model Coefficients (Exponentiated)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:right;\"> Rate Ratio </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n   <th style=\"text-align:right;\"> Z </th>\n   <th style=\"text-align:right;\"> P-Value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 5.261 </td>\n   <td style=\"text-align:right;\"> 0.05 </td>\n   <td style=\"text-align:right;\"> 33.376 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Graffiti_removal </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n   <td style=\"text-align:right;\"> 1.550 </td>\n   <td style=\"text-align:right;\"> 0.121 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Graffiti_clean.nn </td>\n   <td style=\"text-align:right;\"> 0.992 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n   <td style=\"text-align:right;\"> -17.147 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dist_to_hotspot </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n   <td style=\"text-align:right;\"> 3.343 </td>\n   <td style=\"text-align:right;\"> 0.001 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\"><span style=\"font-style: italic;\">Note: </span></td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Rate ratios &gt; 1 indicate positive association with burglary counts.</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n## 9.2: Key Findings Summary\n\n**Technical Performance:**\n\n-   Cross-validation MAE: 2.56\n-   Model vs. KDE: The **KDE baseline outperformed the regression model** (KDE MAE = 2.06 vs. Model MAE = 2.56), indicating that simple spatial smoothing captures burglary risk better than our feature-based mode.\n-   Most predictive variable: **Graffiti_clean.nn** (distance to nearest graffiti-removal activity) had the strongest and most statistically significant effect (rate ratio ≈ 0.992).\n\n**Spatial Patterns:**\n\n-   Burglaries are **Strongly clustered**, not evenly distributed.\n-   Hot spots are located in The **West Side**, parts of the **Near Northwest**, and the **South Side near major commercial corridors**.\n-   Model errors show systematic spatial patterns.\n\n**Model Limitations:**\n\n-   Overdispersion\n-   Spatial autocorrelation in residuals: Likely **present** (errors cluster spatially), suggesting missing spatial processes or unobserved neighborhood characteristics.\n-   Cells with zero counts: A large share of grid cells have zero burglaries (typically **\\>50%**), making the count distribution highly zero-inflated.\n",
    "supporting": [
      "predictive_policing_exercise_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}